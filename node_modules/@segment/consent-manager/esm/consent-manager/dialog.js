import _Object$getPrototypeOf from 'babel-runtime/core-js/object/get-prototype-of';
import _classCallCheck from 'babel-runtime/helpers/classCallCheck';
import _createClass from 'babel-runtime/helpers/createClass';
import _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';
import _inherits from 'babel-runtime/helpers/inherits';
import _taggedTemplateLiteral from 'babel-runtime/helpers/taggedTemplateLiteral';

var _templateObject = _taggedTemplateLiteral(['\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(67, 90, 111, 0.699);\n'], ['\n  position: fixed;\n  left: 0;\n  right: 0;\n  top: 0;\n  bottom: 0;\n  z-index: 1000;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: rgba(67, 90, 111, 0.699);\n']),
    _templateObject2 = _taggedTemplateLiteral(['\n  from {\n    transform: scale(0.8);\n    opacity: 0;\n  }\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n'], ['\n  from {\n    transform: scale(0.8);\n    opacity: 0;\n  }\n  to {\n    transform: scale(1);\n    opacity: 1;\n  }\n']),
    _templateObject3 = _taggedTemplateLiteral(['\n  ', ';\n  display: flex;\n  flex-direction: column;\n  max-width: calc(100vw - 16px);\n  max-height: calc(100vh - 16px);\n  width: ', ';\n  margin: 8px;\n  background: #fff;\n  border-radius: 8px;\n  animation: ', ' ', ' ', ' both;\n'], ['\n  ', ';\n  display: flex;\n  flex-direction: column;\n  max-width: calc(100vw - 16px);\n  max-height: calc(100vh - 16px);\n  width: ', ';\n  margin: 8px;\n  background: #fff;\n  border-radius: 8px;\n  animation: ', ' ', ' ', ' both;\n']),
    _templateObject4 = _taggedTemplateLiteral(['\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n'], ['\n  display: flex;\n  flex-direction: column;\n  min-height: 0;\n']),
    _templateObject5 = _taggedTemplateLiteral(['\n  flex: 1 0 auto;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  border-bottom: 1px solid rgba(67, 90, 111, 0.079);\n'], ['\n  flex: 1 0 auto;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 12px 16px;\n  border-bottom: 1px solid rgba(67, 90, 111, 0.079);\n']),
    _templateObject6 = _taggedTemplateLiteral(['\n  margin: 0;\n  color: #1f4160;\n  font-size: 16px;\n  font-weight: 600;\n  line-height: 1.3;\n'], ['\n  margin: 0;\n  color: #1f4160;\n  font-size: 16px;\n  font-weight: 600;\n  line-height: 1.3;\n']),
    _templateObject7 = _taggedTemplateLiteral(['\n  padding: 8px;\n  border: none;\n  background: none;\n  color: inherit;\n  font: inherit;\n  font-size: 14px;\n  line-height: 1;\n  cursor: pointer;\n'], ['\n  padding: 8px;\n  border: none;\n  background: none;\n  color: inherit;\n  font: inherit;\n  font-size: 14px;\n  line-height: 1;\n  cursor: pointer;\n']),
    _templateObject8 = _taggedTemplateLiteral(['\n  overflow-y: auto;\n  padding: 16px;\n  padding-bottom: 0;\n  min-height: 0;\n  font-size: 14px;\n  line-height: 1.2;\n\n  p {\n    margin: 0;\n    &:not(:last-child) {\n      margin-bottom: 0.7em;\n    }\n  }\n\n  a {\n    color: #47b881;\n    &:hover {\n      color: #64c395;\n    }\n    &:active {\n      color: #248953;\n    }\n  }\n'], ['\n  overflow-y: auto;\n  padding: 16px;\n  padding-bottom: 0;\n  min-height: 0;\n  font-size: 14px;\n  line-height: 1.2;\n\n  p {\n    margin: 0;\n    &:not(:last-child) {\n      margin-bottom: 0.7em;\n    }\n  }\n\n  a {\n    color: #47b881;\n    &:hover {\n      color: #64c395;\n    }\n    &:active {\n      color: #248953;\n    }\n  }\n']),
    _templateObject9 = _taggedTemplateLiteral(['\n  padding: 16px;\n  text-align: right;\n'], ['\n  padding: 16px;\n  text-align: right;\n']);

import React, { PureComponent } from 'react';
import ReactDOM from 'react-dom';
import PropTypes from 'prop-types';
import styled, { keyframes } from 'react-emotion';
import nanoid from 'nanoid';
import fontStyles from './font-styles';

var ANIMATION_DURATION = '200ms';
var ANIMATION_EASING = 'cubic-bezier(0.0, 0.0, 0.2, 1)';

var Overlay = /*#__PURE__*/styled('div', {
  target: 'e160cov60',
  label: 'Overlay'
})(_templateObject);

var openAnimation = /*#__PURE__*/keyframes(_templateObject2, 'label:openAnimation;');

var Root = /*#__PURE__*/styled('section', {
  target: 'e160cov61',
  label: 'Root'
})(_templateObject3, fontStyles, function (props) {
  return props.width;
}, openAnimation, ANIMATION_DURATION, ANIMATION_EASING);

var Form = /*#__PURE__*/styled('form', {
  target: 'e160cov62',
  label: 'Form'
})(_templateObject4);

var Header = /*#__PURE__*/styled('div', {
  target: 'e160cov63',
  label: 'Header'
})(_templateObject5);

var Title = /*#__PURE__*/styled('h2', {
  target: 'e160cov64',
  label: 'Title'
})(_templateObject6);

var HeaderCancelButton = /*#__PURE__*/styled('button', {
  target: 'e160cov65',
  label: 'HeaderCancelButton'
})(_templateObject7);

var Content = /*#__PURE__*/styled('div', {
  target: 'e160cov66',
  label: 'Content'
})(_templateObject8);

var Buttons = /*#__PURE__*/styled('div', {
  target: 'e160cov67',
  label: 'Buttons'
})(_templateObject9);

var Dialog = function (_PureComponent) {
  _inherits(Dialog, _PureComponent);

  function Dialog() {
    _classCallCheck(this, Dialog);

    var _this = _possibleConstructorReturn(this, (Dialog.__proto__ || _Object$getPrototypeOf(Dialog)).call(this));

    _this.handleRootRef = function (node) {
      _this.root = node;
    };

    _this.handleFormRef = function (node) {
      _this.form = node;
    };

    _this.handleOverlayClick = function (e) {
      var onCancel = _this.props.onCancel;

      // Ignore propogated clicks from inside the dialog

      if (onCancel && !_this.root.contains(e.target)) {
        onCancel();
      }
    };

    _this.handleEsc = function (e) {
      var onCancel = _this.props.onCancel;

      // Esc key

      if (onCancel && e.keyCode === 27) {
        onCancel();
      }
    };

    _this.titleId = nanoid();

    _this.container = document.createElement('div');
    _this.container.setAttribute('data-consent-manager-dialog', '');
    document.body.appendChild(_this.container);
    return _this;
  }

  _createClass(Dialog, [{
    key: 'render',
    value: function render() {
      var _props = this.props,
          onCancel = _props.onCancel,
          onSubmit = _props.onSubmit,
          title = _props.title,
          children = _props.children,
          buttons = _props.buttons,
          width = _props.width;


      var dialog = React.createElement(
        Overlay,
        { onClick: this.handleOverlayClick },
        React.createElement(
          Root,
          {
            innerRef: this.handleRootRef,
            role: 'dialog',
            'aria-modal': true,
            'aria-labelledby': this.titleId,
            width: width
          },
          React.createElement(
            Header,
            null,
            React.createElement(
              Title,
              { id: this.titleId },
              title
            ),
            onCancel && React.createElement(
              HeaderCancelButton,
              {
                onClick: onCancel,
                title: 'Cancel',
                'aria-label': 'Cancel'
              },
              '\u2715'
            )
          ),
          React.createElement(
            Form,
            { innerRef: this.handleFormRef, onSubmit: onSubmit },
            React.createElement(
              Content,
              null,
              children
            ),
            React.createElement(
              Buttons,
              null,
              buttons
            )
          )
        )
      );

      return ReactDOM.createPortal(dialog, this.container);
    }
  }, {
    key: 'componentDidMount',
    value: function componentDidMount() {
      var innerRef = this.props.innerRef;


      this.form.querySelector('input,button').focus();
      document.body.addEventListener('keydown', this.handleEsc, false);
      document.body.style.overflow = 'hidden';

      innerRef(this.container);
    }
  }, {
    key: 'componentWillUnmount',
    value: function componentWillUnmount() {
      var innerRef = this.props.innerRef;


      document.body.removeEventListener('keydown', this.handleEsc, false);
      document.body.style.overflow = '';

      document.body.removeChild(this.container);
      innerRef(null);
    }
  }]);

  return Dialog;
}(PureComponent);

Dialog.displayName = 'Dialog';
Dialog.propTypes = {
  innerRef: PropTypes.func.isRequired,
  onCancel: PropTypes.func,
  onSubmit: PropTypes.func.isRequired,
  title: PropTypes.node.isRequired,
  children: PropTypes.node.isRequired,
  buttons: PropTypes.node.isRequired,
  width: PropTypes.string
};
Dialog.defaultProps = {
  onCancel: undefined,
  width: '750px'
};
export default Dialog;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb25zZW50LW1hbmFnZXIvZGlhbG9nLmpzIl0sIm5hbWVzIjpbIlJlYWN0IiwiUHVyZUNvbXBvbmVudCIsIlJlYWN0RE9NIiwiUHJvcFR5cGVzIiwic3R5bGVkIiwia2V5ZnJhbWVzIiwibmFub2lkIiwiZm9udFN0eWxlcyIsIkFOSU1BVElPTl9EVVJBVElPTiIsIkFOSU1BVElPTl9FQVNJTkciLCJPdmVybGF5Iiwib3BlbkFuaW1hdGlvbiIsIlJvb3QiLCJwcm9wcyIsIndpZHRoIiwiRm9ybSIsIkhlYWRlciIsIlRpdGxlIiwiSGVhZGVyQ2FuY2VsQnV0dG9uIiwiQ29udGVudCIsIkJ1dHRvbnMiLCJEaWFsb2ciLCJoYW5kbGVSb290UmVmIiwicm9vdCIsIm5vZGUiLCJoYW5kbGVGb3JtUmVmIiwiZm9ybSIsImhhbmRsZU92ZXJsYXlDbGljayIsIm9uQ2FuY2VsIiwiY29udGFpbnMiLCJlIiwidGFyZ2V0IiwiaGFuZGxlRXNjIiwia2V5Q29kZSIsInRpdGxlSWQiLCJjb250YWluZXIiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzZXRBdHRyaWJ1dGUiLCJib2R5IiwiYXBwZW5kQ2hpbGQiLCJvblN1Ym1pdCIsInRpdGxlIiwiY2hpbGRyZW4iLCJidXR0b25zIiwiZGlhbG9nIiwiY3JlYXRlUG9ydGFsIiwiaW5uZXJSZWYiLCJxdWVyeVNlbGVjdG9yIiwiZm9jdXMiLCJhZGRFdmVudExpc3RlbmVyIiwic3R5bGUiLCJvdmVyZmxvdyIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJyZW1vdmVDaGlsZCIsImRpc3BsYXlOYW1lIiwicHJvcFR5cGVzIiwiZnVuYyIsImlzUmVxdWlyZWQiLCJzdHJpbmciLCJkZWZhdWx0UHJvcHMiLCJ1bmRlZmluZWQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBQUEsT0FBT0EsS0FBUCxJQUFlQyxhQUFmLFFBQW1DLE9BQW5DO0FBQ0EsT0FBT0MsUUFBUCxNQUFxQixXQUFyQjtBQUNBLE9B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LENBQTBCLEtBQUtuQixTQUEvQjtBQUNBWSxlQUFTLElBQVQ7QUFDRDs7OztFQW5GaUM5QyxhOztBQUFmb0IsTSxDQUNaa0MsVyxHQUFjLFE7QUFERmxDLE0sQ0FHWm1DLFMsR0FBWTtBQUNqQlQsWUFBVTVDLFVBQVVzRCxJQUFWLENBQWVDLFVBRFI7QUFFakI5QixZQUFVekIsVUFBVXNELElBRkg7QUFHakJoQixZQUFVdEMsVUFBVXNELElBQVYsQ0FBZUMsVUFIUjtBQUlqQmhCLFNBQU92QyxVQUFVcUIsSUFBVixDQUFla0MsVUFKTDtBQUtqQmYsWUFBVXhDLFVBQVVxQixJQUFWLENBQWVrQyxVQUxSO0FBTWpCZCxXQUFTekMsVUFBVXFCLElBQVYsQ0FBZWtDLFVBTlA7QUFPakI1QyxTQUFPWCxVQUFVd0Q7QUFQQSxDO0FBSEF0QyxNLENBYVp1QyxZLEdBQWU7QUFDcEJoQyxZQUFVaUMsU0FEVTtBQUVwQi9DLFNBQU87QUFGYSxDO2VBYkhPLE0iLCJmaWxlIjoiZGlhbG9nLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7UHVyZUNvbXBvbmVudH0gZnJvbSAncmVhY3QnXG5pbXBvcnQgUmVhY3RET00gZnJvbSAncmVhY3QtZG9tJ1xuaW1wb3J0IFByb3BUeXBlcyBmcm9tICdwcm9wLXR5cGVzJ1xuaW1wb3J0IHN0eWxlZCwge2tleWZyYW1lc30gZnJvbSAncmVhY3QtZW1vdGlvbidcbmltcG9ydCBuYW5vaWQgZnJvbSAnbmFub2lkJ1xuaW1wb3J0IGZvbnRTdHlsZXMgZnJvbSAnLi9mb250LXN0eWxlcydcblxuY29uc3QgQU5JTUFUSU9OX0RVUkFUSU9OID0gJzIwMG1zJ1xuY29uc3QgQU5JTUFUSU9OX0VBU0lORyA9ICdjdWJpYy1iZXppZXIoMC4wLCAwLjAsIDAuMiwgMSknXG5cbmNvbnN0IE92ZXJsYXkgPSBzdHlsZWQoJ2RpdicpYFxuICBwb3NpdGlvbjogZml4ZWQ7XG4gIGxlZnQ6IDA7XG4gIHJpZ2h0OiAwO1xuICB0b3A6IDA7XG4gIGJvdHRvbTogMDtcbiAgei1pbmRleDogMTAwMDtcbiAgZGlzcGxheTogZmxleDtcbiAgYWxpZ24taXRlbXM6IGNlbnRlcjtcbiAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7XG4gIGJhY2tncm91bmQ6IHJnYmEoNjcsIDkwLCAxMTEsIDAuNjk5KTtcbmBcblxuY29uc3Qgb3BlbkFuaW1hdGlvbiA9IGtleWZyYW1lc2BcbiAgZnJvbSB7XG4gICAgdHJhbnNmb3JtOiBzY2FsZSgwLjgpO1xuICAgIG9wYWNpdHk6IDA7XG4gIH1cbiAgdG8ge1xuICAgIHRyYW5zZm9ybTogc2NhbGUoMSk7XG4gICAgb3BhY2l0eTogMTtcbiAgfVxuYFxuXG5jb25zdCBSb290ID0gc3R5bGVkKCdzZWN0aW9uJylgXG4gICR7Zm9udFN0eWxlc307XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47XG4gIG1heC13aWR0aDogY2FsYygxMDB2dyAtIDE2cHgpO1xuICBtYXgtaGVpZ2h0OiBjYWxjKDEwMHZoIC0gMTZweCk7XG4gIHdpZHRoOiAke3Byb3BzID0+IHByb3BzLndpZHRofTtcbiAgbWFyZ2luOiA4cHg7XG4gIGJhY2tncm91bmQ6ICNmZmY7XG4gIGJvcmRlci1yYWRpdXM6IDhweDtcbiAgYW5pbWF0aW9uOiAke29wZW5BbmltYXRpb259ICR7QU5JTUFUSU9OX0RVUkFUSU9OfSAke0FOSU1BVElPTl9FQVNJTkd9IGJvdGg7XG5gXG5cbmNvbnN0IEZvcm0gPSBzdHlsZWQoJ2Zvcm0nKWBcbiAgZGlzcGxheTogZmxleDtcbiAgZmxleC1kaXJlY3Rpb246IGNvbHVtbjtcbiAgbWluLWhlaWdodDogMDtcbmBcblxuY29uc3QgSGVhZGVyID0gc3R5bGVkKCdkaXYnKWBcbiAgZmxleDogMSAwIGF1dG87XG4gIGRpc3BsYXk6IGZsZXg7XG4gIGFsaWduLWl0ZW1zOiBjZW50ZXI7XG4gIGp1c3RpZnktY29udGVudDogc3BhY2UtYmV0d2VlbjtcbiAgcGFkZGluZzogMTJweCAxNnB4O1xuICBib3JkZXItYm90dG9tOiAxcHggc29saWQgcmdiYSg2NywgOTAsIDExMSwgMC4wNzkpO1xuYFxuXG5jb25zdCBUaXRsZSA9IHN0eWxlZCgnaDInKWBcbiAgbWFyZ2luOiAwO1xuICBjb2xvcjogIzFmNDE2MDtcbiAgZm9udC1zaXplOiAxNnB4O1xuICBmb250LXdlaWdodDogNjAwO1xuICBsaW5lLWhlaWdodDogMS4zO1xuYFxuXG5jb25zdCBIZWFkZXJDYW5jZWxCdXR0b24gPSBzdHlsZWQoJ2J1dHRvbicpYFxuICBwYWRkaW5nOiA4cHg7XG4gIGJvcmRlcjogbm9uZTtcbiAgYmFja2dyb3VuZDogbm9uZTtcbiAgY29sb3I6IGluaGVyaXQ7XG4gIGZvbnQ6IGluaGVyaXQ7XG4gIGZvbnQtc2l6ZTogMTRweDtcbiAgbGluZS1oZWlnaHQ6IDE7XG4gIGN1cnNvcjogcG9pbnRlcjtcbmBcblxuY29uc3QgQ29udGVudCA9IHN0eWxlZCgnZGl2JylgXG4gIG92ZXJmbG93LXk6IGF1dG87XG4gIHBhZGRpbmc6IDE2cHg7XG4gIHBhZGRpbmctYm90dG9tOiAwO1xuICBtaW4taGVpZ2h0OiAwO1xuICBmb250LXNpemU6IDE0cHg7XG4gIGxpbmUtaGVpZ2h0OiAxLjI7XG5cbiAgcCB7XG4gICAgbWFyZ2luOiAwO1xuICAgICY6bm90KDpsYXN0LWNoaWxkKSB7XG4gICAgICBtYXJnaW4tYm90dG9tOiAwLjdlbTtcbiAgICB9XG4gIH1cblxuICBhIHtcbiAgICBjb2xvcjogIzQ3Yjg4MTtcbiAgICAmOmhvdmVyIHtcbiAgICAgIGNvbG9yOiAjNjRjMzk1O1xuICAgIH1cbiAgICAmOmFjdGl2ZSB7XG4gICAgICBjb2xvcjogIzI0ODk1MztcbiAgICB9XG4gIH1cbmBcblxuY29uc3QgQnV0dG9ucyA9IHN0eWxlZCgnZGl2JylgXG4gIHBhZGRpbmc6IDE2cHg7XG4gIHRleHQtYWxpZ246IHJpZ2h0O1xuYFxuXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBEaWFsb2cgZXh0ZW5kcyBQdXJlQ29tcG9uZW50IHtcbiAgc3RhdGljIGRpc3BsYXlOYW1lID0gJ0RpYWxvZydcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGlubmVyUmVmOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIG9uQ2FuY2VsOiBQcm9wVHlwZXMuZnVuYyxcbiAgICBvblN1Ym1pdDogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICB0aXRsZTogUHJvcFR5cGVzLm5vZGUuaXNSZXF1aXJlZCxcbiAgICBjaGlsZHJlbjogUHJvcFR5cGVzLm5vZGUuaXNSZXF1aXJlZCxcbiAgICBidXR0b25zOiBQcm9wVHlwZXMubm9kZS5pc1JlcXVpcmVkLFxuICAgIHdpZHRoOiBQcm9wVHlwZXMuc3RyaW5nXG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIG9uQ2FuY2VsOiB1bmRlZmluZWQsXG4gICAgd2lkdGg6ICc3NTBweCdcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKCkge1xuICAgIHN1cGVyKClcblxuICAgIHRoaXMudGl0bGVJZCA9IG5hbm9pZCgpXG5cbiAgICB0aGlzLmNvbnRhaW5lciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpXG4gICAgdGhpcy5jb250YWluZXIuc2V0QXR0cmlidXRlKCdkYXRhLWNvbnNlbnQtbWFuYWdlci1kaWFsb2cnLCAnJylcbiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKHRoaXMuY29udGFpbmVyKVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIGNvbnN0IHtvbkNhbmNlbCwgb25TdWJtaXQsIHRpdGxlLCBjaGlsZHJlbiwgYnV0dG9ucywgd2lkdGh9ID0gdGhpcy5wcm9wc1xuXG4gICAgY29uc3QgZGlhbG9nID0gKFxuICAgICAgPE92ZXJsYXkgb25DbGljaz17dGhpcy5oYW5kbGVPdmVybGF5Q2xpY2t9PlxuICAgICAgICA8Um9vdFxuICAgICAgICAgIGlubmVyUmVmPXt0aGlzLmhhbmRsZVJvb3RSZWZ9XG4gICAgICAgICAgcm9sZT1cImRpYWxvZ1wiXG4gICAgICAgICAgYXJpYS1tb2RhbFxuICAgICAgICAgIGFyaWEtbGFiZWxsZWRieT17dGhpcy50aXRsZUlkfVxuICAgICAgICAgIHdpZHRoPXt3aWR0aH1cbiAgICAgICAgPlxuICAgICAgICAgIDxIZWFkZXI+XG4gICAgICAgICAgICA8VGl0bGUgaWQ9e3RoaXMudGl0bGVJZH0+e3RpdGxlfTwvVGl0bGU+XG4gICAgICAgICAgICB7b25DYW5jZWwgJiYgKFxuICAgICAgICAgICAgICA8SGVhZGVyQ2FuY2VsQnV0dG9uXG4gICAgICAgICAgICAgICAgb25DbGljaz17b25DYW5jZWx9XG4gICAgICAgICAgICAgICAgdGl0bGU9XCJDYW5jZWxcIlxuICAgICAgICAgICAgICAgIGFyaWEtbGFiZWw9XCJDYW5jZWxcIlxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAg4pyVXG4gICAgICAgICAgICAgIDwvSGVhZGVyQ2FuY2VsQnV0dG9uPlxuICAgICAgICAgICAgKX1cbiAgICAgICAgICA8L0hlYWRlcj5cblxuICAgICAgICAgIDxGb3JtIGlubmVyUmVmPXt0aGlzLmhhbmRsZUZvcm1SZWZ9IG9uU3VibWl0PXtvblN1Ym1pdH0+XG4gICAgICAgICAgICA8Q29udGVudD57Y2hpbGRyZW59PC9Db250ZW50PlxuXG4gICAgICAgICAgICA8QnV0dG9ucz57YnV0dG9uc308L0J1dHRvbnM+XG4gICAgICAgICAgPC9Gb3JtPlxuICAgICAgICA8L1Jvb3Q+XG4gICAgICA8L092ZXJsYXk+XG4gICAgKVxuXG4gICAgcmV0dXJuIFJlYWN0RE9NLmNyZWF0ZVBvcnRhbChkaWFsb2csIHRoaXMuY29udGFpbmVyKVxuICB9XG5cbiAgY29tcG9uZW50RGlkTW91bnQoKSB7XG4gICAgY29uc3Qge2lubmVyUmVmfSA9IHRoaXMucHJvcHNcblxuICAgIHRoaXMuZm9ybS5xdWVyeVNlbGVjdG9yKCdpbnB1dCxidXR0b24nKS5mb2N1cygpXG4gICAgZG9jdW1lbnQuYm9keS5hZGRFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5oYW5kbGVFc2MsIGZhbHNlKVxuICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnaGlkZGVuJ1xuXG4gICAgaW5uZXJSZWYodGhpcy5jb250YWluZXIpXG4gIH1cblxuICBjb21wb25lbnRXaWxsVW5tb3VudCgpIHtcbiAgICBjb25zdCB7aW5uZXJSZWZ9ID0gdGhpcy5wcm9wc1xuXG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVFdmVudExpc3RlbmVyKCdrZXlkb3duJywgdGhpcy5oYW5kbGVFc2MsIGZhbHNlKVxuICAgIGRvY3VtZW50LmJvZHkuc3R5bGUub3ZlcmZsb3cgPSAnJ1xuXG4gICAgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZCh0aGlzLmNvbnRhaW5lcilcbiAgICBpbm5lclJlZihudWxsKVxuICB9XG5cbiAgaGFuZGxlUm9vdFJlZiA9IG5vZGUgPT4ge1xuICAgIHRoaXMucm9vdCA9IG5vZGVcbiAgfVxuXG4gIGhhbmRsZUZvcm1SZWYgPSBub2RlID0+IHtcbiAgICB0aGlzLmZvcm0gPSBub2RlXG4gIH1cblxuICBoYW5kbGVPdmVybGF5Q2xpY2sgPSBlID0+IHtcbiAgICBjb25zdCB7b25DYW5jZWx9ID0gdGhpcy5wcm9wc1xuXG4gICAgLy8gSWdub3JlIHByb3BvZ2F0ZWQgY2xpY2tzIGZyb20gaW5zaWRlIHRoZSBkaWFsb2dcbiAgICBpZiAob25DYW5jZWwgJiYgIXRoaXMucm9vdC5jb250YWlucyhlLnRhcmdldCkpIHtcbiAgICAgIG9uQ2FuY2VsKClcbiAgICB9XG4gIH1cblxuICBoYW5kbGVFc2MgPSBlID0+IHtcbiAgICBjb25zdCB7b25DYW5jZWx9ID0gdGhpcy5wcm9wc1xuXG4gICAgLy8gRXNjIGtleVxuICAgIGlmIChvbkNhbmNlbCAmJiBlLmtleUNvZGUgPT09IDI3KSB7XG4gICAgICBvbkNhbmNlbCgpXG4gICAgfVxuICB9XG59XG4iXX0=