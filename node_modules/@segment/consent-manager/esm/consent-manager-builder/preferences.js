// TODO: remove duplicate cookie library from bundle
import cookies from 'js-cookie';
import topDomain from '@segment/top-domain';

var COOKIE_KEY = 'tracking-preferences';
var COOKIE_EXPIRES = 365;

// TODO: harden against invalid cookies
export function loadPreferences() {
  var preferences = cookies.getJSON(COOKIE_KEY);

  if (!preferences) {
    return {};
  }

  return {
    destinationPreferences: preferences.destinations,
    customPreferences: preferences.custom
  };
}

export function savePreferences(_ref) {
  var destinationPreferences = _ref.destinationPreferences,
      customPreferences = _ref.customPreferences,
      cookieDomain = _ref.cookieDomain;

  window.analytics.identify({
    destinationTrackingPreferences: destinationPreferences,
    customTrackingPreferences: customPreferences
  });

  var domain = cookieDomain || topDomain(window.location.href);
  var value = {
    version: 1,
    destinations: destinationPreferences,
    custom: customPreferences
  };
  cookies.set(COOKIE_KEY, value, {
    expires: COOKIE_EXPIRES,
    domain: domain
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9jb25zZW50LW1hbmFnZXItYnVpbGRlci9wcmVmZXJlbmNlcy5qcyJdLCJuYW1lcyI6WyJjb29raWVzIiwidG9wRG9tYWluIiwiQ09PS0lFX0tFWSIsIkNPT0tJRV9FWFBJUkVTIiwibG9hZFByZWZlcmVuY2VzIiwicHJlZmVyZW5jZXMiLCJnZXRKU09OIiwiZGVzdGluYXRpb25QcmVmZXJlbmNlcyIsImRlc3RpbmF0aW9ucyIsImN1c3RvbVByZWZlcmVuY2VzIiwiY3VzdG9tIiwic2F2ZVByZWZlcmVuY2VzIiwiY29va2llRG9tYWluIiwid2luZG93IiwiYW5hbHl0aWNzIiwiaWRlbnRpZnkiLCJkZXN0aW5hdGlvblRyYWNraW5nUHJlZmVyZW5jZXMiLCJjdXN0b21UcmFja2luZ1ByZWZlcmVuY2VzIiwiZG9tYWluIiwibG9jYXRpb24iLCJocmVmIiwidmFsdWUiLCJ2ZXJzaW9uIiwic2V0IiwiZXhwaXJlcyJdLCJtYXBwaW5ncyI6IkFBQUE7QUFDQSxPQUFPQSxPQUFQLE1BQW9CLFdBQXBCO0FBQ0EsT0FBT0MsU0FBUCxNQUFzQixxQkFBdEI7O0FBRUEsSUFBTUMsYUFBYSxzQkFBbkI7QUFDQSxJQUFNQyxpQkFBaUIsR0FBdkI7O0FBRUE7QUFDQSxPQUFPLFNBQVNDLGVBQVQsR0FBMkI7QUFDaEMsTUFBTUMsY0FBY0wsUUFBUU0sT0FBUixDQUFnQkosVUFBaEIsQ0FBcEI7O0FBRUEsTUFBSSxDQUFDRyxXQUFMLEVBQWtCO0FBQ2hCLFdBQU8sRUFBUDtBQUNEOztBQUVELFNBQU87QUFDTEUsNEJBQXdCRixZQUFZRyxZQUQvQjtBQUVMQyx1QkFBbUJKLFlBQVlLO0FBRjFCLEdBQVA7QUFJRDs7QUFFRCxPQUFPLFNBQVNDLGVBQVQsT0FJSjtBQUFBLE1BSERKLHNCQUdDLFFBSERBLHNCQUdDO0FBQUEsTUFGREUsaUJBRUMsUUFGREEsaUJBRUM7QUFBQSxNQURERyxZQUNDLFFBRERBLFlBQ0M7O0FBQ0RDLFNBQU9DLFNBQVAsQ0FBaUJDLFFBQWpCLENBQTBCO0FBQ3hCQyxvQ0FBZ0NULHNCQURSO0FBRXhCVSwrQkFBMkJSO0FBRkgsR0FBMUI7O0FBS0EsTUFBTVMsU0FBU04sZ0JBQWdCWCxVQUFVWSxPQUFPTSxRQUFQLENBQWdCQyxJQUExQixDQUEvQjtBQUNBLE1BQU1DLFFBQVE7QUFDWkMsYUFBUyxDQURHO0FBRVpkLGtCQUFjRCxzQkFGRjtBQUdaRyxZQUFRRDtBQUhJLEdBQWQ7QUFLQVQsVUFBUXVCLEdBQVIsQ0FBWXJCLFVBQVosRUFBd0JtQixLQUF4QixFQUErQjtBQUM3QkcsYUFBU3JCLGNBRG9CO0FBRTdCZTtBQUY2QixHQUEvQjtBQUlEIiwiZmlsZSI6InByZWZlcmVuY2VzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy8gVE9ETzogcmVtb3ZlIGR1cGxpY2F0ZSBjb29raWUgbGlicmFyeSBmcm9tIGJ1bmRsZVxuaW1wb3J0IGNvb2tpZXMgZnJvbSAnanMtY29va2llJ1xuaW1wb3J0IHRvcERvbWFpbiBmcm9tICdAc2VnbWVudC90b3AtZG9tYWluJ1xuXG5jb25zdCBDT09LSUVfS0VZID0gJ3RyYWNraW5nLXByZWZlcmVuY2VzJ1xuY29uc3QgQ09PS0lFX0VYUElSRVMgPSAzNjVcblxuLy8gVE9ETzogaGFyZGVuIGFnYWluc3QgaW52YWxpZCBjb29raWVzXG5leHBvcnQgZnVuY3Rpb24gbG9hZFByZWZlcmVuY2VzKCkge1xuICBjb25zdCBwcmVmZXJlbmNlcyA9IGNvb2tpZXMuZ2V0SlNPTihDT09LSUVfS0VZKVxuXG4gIGlmICghcHJlZmVyZW5jZXMpIHtcbiAgICByZXR1cm4ge31cbiAgfVxuXG4gIHJldHVybiB7XG4gICAgZGVzdGluYXRpb25QcmVmZXJlbmNlczogcHJlZmVyZW5jZXMuZGVzdGluYXRpb25zLFxuICAgIGN1c3RvbVByZWZlcmVuY2VzOiBwcmVmZXJlbmNlcy5jdXN0b21cbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gc2F2ZVByZWZlcmVuY2VzKHtcbiAgZGVzdGluYXRpb25QcmVmZXJlbmNlcyxcbiAgY3VzdG9tUHJlZmVyZW5jZXMsXG4gIGNvb2tpZURvbWFpblxufSkge1xuICB3aW5kb3cuYW5hbHl0aWNzLmlkZW50aWZ5KHtcbiAgICBkZXN0aW5hdGlvblRyYWNraW5nUHJlZmVyZW5jZXM6IGRlc3RpbmF0aW9uUHJlZmVyZW5jZXMsXG4gICAgY3VzdG9tVHJhY2tpbmdQcmVmZXJlbmNlczogY3VzdG9tUHJlZmVyZW5jZXNcbiAgfSlcblxuICBjb25zdCBkb21haW4gPSBjb29raWVEb21haW4gfHwgdG9wRG9tYWluKHdpbmRvdy5sb2NhdGlvbi5ocmVmKVxuICBjb25zdCB2YWx1ZSA9IHtcbiAgICB2ZXJzaW9uOiAxLFxuICAgIGRlc3RpbmF0aW9uczogZGVzdGluYXRpb25QcmVmZXJlbmNlcyxcbiAgICBjdXN0b206IGN1c3RvbVByZWZlcmVuY2VzXG4gIH1cbiAgY29va2llcy5zZXQoQ09PS0lFX0tFWSwgdmFsdWUsIHtcbiAgICBleHBpcmVzOiBDT09LSUVfRVhQSVJFUyxcbiAgICBkb21haW5cbiAgfSlcbn1cbiJdfQ==